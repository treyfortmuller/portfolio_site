<!DOCTYPE HTML>
<html>
	<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

<title>Waterproof Quadcopter Build</title>
<meta name="description" content="">

<link rel="apple-touch-icon" sizes="180x180" href="/assets/icon/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/icon/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/icon/favicon-16x16.png">
<link rel="manifest" href="/assets/icon/manifest.json">
<link rel="mask-icon" href="/assets/icon/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/icon/favicon.ico">
<meta name="msapplication-config" content="/assets/icon/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<!-- CSS -->
<link rel="stylesheet" href="/assets/css/main.css">
<noscript><link rel="stylesheet" href="/assets/css/noscript.css"></noscript>

<!-- MathJax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-MML-AM_CHTML" async></script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: [
      "MathMenu.js",
      "MathZoom.js",
      "AssistiveMML.js",
      "a11y/accessibility-menu.js"
    ],
    jax: ["input/TeX", "output/CommonHTML"],
    TeX: {
      extensions: [
        "AMSmath.js",
        "AMSsymbols.js",
        "noErrors.js",
        "noUndefined.js",
      ]
    }
  });
</script>

	</head>
	<body class="is-loading">

		<!-- Wrapper -->
			<div id="wrapper" class="fade-in">

				<!-- Header -->
        <header id="header">
          <a href="/" class="logo">Trey Fortmuller</a>
        </header>

				<!-- Nav -->
					<nav id="nav">

            <ul class="links">
  <li class=""><a href="/">Projects</a></li>
  <li class=""><a href="/about/">About</a></li>
<!--   <li class=" active "><a href="/projects/">Projects</a></li> -->
  <li class=""><a href="/resume/">Resume</a></li>
  <li class=""><a href="/publications/">Publications</a></li>  
</ul>


						<ul class="icons">
              <li><a href="https://www.linkedin.com/in/trey-fortmuller" class="icon fa-linkedin" rel="nofollow"><span class="label">LinkedIn</span></a></li>
              <li><a href="https://github.com/treyfortmuller" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
              <!-- <li><a href="https://facebook.com/trey.fortmuller" class="icon fa-facebook" rel="nofollow"><span class="label">Facebook</span></a></li> -->
            </ul>
					</nav>

				<!-- Main -->
				<div id="main">
          <section class="post">
    				<header class="major">
      				<span class="date">15 Dec 2017</span>
      				<h1>Waterproof Quadcopter Build</h1>
      				<p>A waterproof quadcopter built around the crazyflie flight controller for a professor researching aquatic drone launches.</p>
      			</header>
      			<div class="image main"><img src="/images/waterproof/waterproof_main.jpg" alt=""></div>
      			<p></p>
<h2 id="introduction">Introduction</h2>

<p>After taking “Intro to Control for UAVs” (ME136) in the Fall of 2017, the professor, Mark Mueller, recruited my lab team (my good friends David and Joey, and myself) to design and build a quadcopter to be used in his lab for research purposes. One of his graduate students is working on launching a drone from the ocean. This platform will be a test rig to be used within the lab as the grad student works on modeling the dynamics of an aquatic launch and developing control systems to achieve this reliably.</p>

<p>This effort did ultimately lead to conference paper published in the proceedings of the 2019 International Conference on Unmanned Aircraft Systems (<a href="http://www.uasconferences.com/">ICUAS</a>). The paper, authored by my HiPeRLab colleague Jiaming Zha, is entitled “Towards breaching a still water surface with a miniature unmanned aerial underwater vehicle” and is available
<a href="http://hiperlab.berkeley.edu/wp-content/uploads/2019/05/Towards-breaching-a-still-water-surface-with-a-miniature-unmanned-aerial-underwater-vehicle.pdf">here</a>.</p>

<h2 id="requirements">Requirements</h2>

<p>The build had to employ the same flight controller that the lab already used for their other drone related projects, the <a href="https://www.bitcraze.io/crazyflie-2/">Crazyflie</a> from Bitcraze, a PCB designed to drive brushed motors.</p>

<div class="row">
	<ul>
		<li>Run the Crazyflie flight control board (an STM F4 microcontroller)</li>
		<li>Have enough room for a radio based <a href="https://www.bitcraze.io/loco-pos-system/">localization unit</a> used for state estimation</li>
		<li>Limit voltage to a 2S LiPo's 8.4V</li>
		<li>Must be compact, less than 200mm motor shaft to motor shaft</li>
		<li>Must be agile, at least a 2:1 thrust to weight ratio</li>
		<li>Operate down to 3m of depth</li>
		<li>Full battery voltage telemetry</li>
	</ul>
</div>

<h2 id="component-specification">Component Specification</h2>

<p><span class="image right"><img src="/images/waterproof/waterproof6.png" alt=""></span></p>

<p>Systems engineering for a multirotor is a large optimization problem including factors such as motor stator size, motor KV, prop diameter and airfoil, battery voltage and capacity, and aircraft size, weight, and configuration. Thankfully the requirements for the platform narrowed down our choices.</p>

<p>We estimated we could meet all the requirements with a craft weighing around 100g. Based on existing motor thrust testing, we found that an 1104 7500KV motor could achieve 100g thrust on 2S running a 2-inch prop, so we’d achieve a power to weight ratio of roughly 4:1.</p>

<p>With this, we decided on a 2S LiPo at 400mAh. Knowing that all our components would have to be submersible, we decided to look around 10A rated 4-in-1 ESCs (4 ESCs for brushless motors on one PCB for easy mounting inside a waterproof enclosure).</p>

<p>With our powertrain specified, we found the proper components on Amazon and began recreating them in CAD so I could design our frame and waterproof enclosure around them. The Bill of Materials for off the shelf components we included in the build is as follows:</p>

<h3>Bill of Materials</h3>
<div class="table-wrapper">
	<table>
		<thead>
			<tr>
				<th>Item</th>
				<th>Description</th>
				<th>Total Weight Contribution (grams)</th>
			</tr>
		</thead>
		<tbody>
			<tr>
				<td><a href="https://store.bitcraze.io/collections/kits/products/crazyflie-2-0">Crazyflie Flight Controller</a></td>
				<td>STM F4 based microcontroller with an IMU and several UARTs</td>
				<td>7</td>
			</tr>
			<tr>
				<td><a href="https://store.bitcraze.io/collections/positioning/products/loco-positioning-deck">Bitcraze Loco Positioning Deck</a></td>
				<td>RF based localization module</td>
				<td>3.3</td>
			</tr>
			<tr>
				<td><a href="https://www.amazon.com/iPower-Motor-Brushless-Quadcopter-Torrent/dp/B01N7QDZY6/ref=sr_1_3?ie=UTF8&amp;qid=1510622724&amp;sr=8-3&amp;keywords=1104+7500kv">iPower iX1104 7500KV Brushless Motor</a></td>
				<td>Brushless motors</td>
				<td>22</td>
			</tr>
			<tr>
				<td><a href="https://www.amazon.com/BLHeli_S-Electronic-Controller-Multirotor-Crazepony/dp/B076BDHCHX/ref=sr_1_4?rps=1&amp;ie=UTF8&amp;qid=1510621639&amp;sr=8-4&amp;keywords=20x20+10A+ESC&amp;refinements=p_85%3A2470955011">Wave 4-in-1 10A ESC</a></td>
				<td>Single PCB with 4 ESCs for brushless motors rated for 10A continuous</td>
				<td>6</td>
			</tr>
			<tr>
				<td><a href="https://www.amazon.com/Crazepony-400mAh-Battery-Racing-Quadcopter/dp/B072BH1XP6/ref=sr_1_1?ie=UTF8&amp;qid=1510622347&amp;sr=8-1&amp;keywords=2S+400+mah&amp;dpID=410fHvjWLiL&amp;preST=_SY300_QL70_&amp;dpSrc=srch">Crazepony 400mAh 2S 7.4V 30C LiPo</a></td>
				<td>A small 2-cell LiPo</td>
				<td>22</td>
			</tr>
			<tr>
				<td><a href="https://www.amazon.com/Propellers-Compatible-6200-10000KV-Brushless-Transparent/dp/B074NP3LFF/ref=sr_1_1?s=toys-and-games&amp;rps=1&amp;ie=UTF8&amp;qid=1510622468&amp;sr=1-1&amp;keywords=2inch+props&amp;refinements=p_85%3A2470955011">Gemfan 2040 Tri-blade Props</a></td>
				<td>Some 2 inch diameter tri-blade propellers</td>
				<td>3.6</td>
			</tr>
			<tr>
				<td><a href="https://www.amazon.com/Matek-Systems-Adjustable-Switchboard-Continuous/dp/B01EACBW6E/ref=sr_1_fkmr1_4?ie=UTF8&amp;qid=1511574313&amp;sr=8-4-fkmr1&amp;keywords=matek+5V+regulator">Matek Systems Micro BEC 5V/12V Adjustable Buck Module</a></td>
				<td>Battery eliminator, a 5V bucking regulator</td>
				<td>1</td>
			</tr>
		</tbody>
	</table>
</div>

<h2 id="design">Design</h2>

<p><span class="image right"><img src="/images/waterproof/waterproof4.png" alt=""></span></p>

<p>The main design constraint was the requirement that the vehicle must be submersible. Brushless motors are waterproof out of the box due to the insulating enamel applied to the wires of the motor winding in the stator, they can operate underwater without modification. Everything else (flight controller, ESCs, localization module, voltage regulator, battery) had to somehow be waterproofed or inside a watertight container.</p>

<p>David, Joey, and I brainstormed on how we might protect the sensitive PCBs from the elements within a container. For the sake of preserving an ideal center of mass, close to the geometric center of the vehicle, we decided on two cases which sandwich the frame of the quadcopter. The top case contains all the sensitive PCBs and the battery is protected by the bottom case. A hole is cut in the frame for the battery lead to reach the ESCs and regulator in the top case. 20+ hours of CADing in Fusion 360 later, I completed the full vehicle assembly including a custom frame, top and bottom cases, as well as gaskets to seal the cases against the frame. I included every single PCB as each would be mounted in the case and designed the cases around the components. This ensured a reasonable fit as well as the accuracy of the inertia tensor of the vehicle, an input to the PX4 firmware the lab had running on board the Crazyflies for flight control.</p>

<p><span class="image main"><img src="/images/waterproof/waterproof_main2.png" alt=""></span></p>

<p>The electronics are mounted inside the top case using TPE mounting solutions, CA glue, heavy duty double sided foam tape, and M2 fasteners. There are 4 holes in the top case which allow the motor wires to reach the ESC board inside the case. Those holes would be filled with a rubbery silicon caulking with the wires threaded through.</p>

<h2 id="fabrication">Fabrication</h2>

<h3 id="watertight-cases">Watertight Cases</h3>

<p><span class="image left"><img src="/images/waterproof/waterproof1.jpg" alt=""></span></p>

<p>3D printing was the natural choice for fabrication of the custom cases, but normal FDM prints are not watertight. Small gaps between layers can allow some water to permeate even a thick shell of typical 3D printing plastics. SLA type prints (laser/projection based resin curing processes) are bound at a molecular level, so those are watertight. Thankfully at Jacobs Hall on campus at UC Berkeley, we had access to a Carbon3D printer for fabrication of the cases. I had never printed anything with an SLA printer before, it was definitely a learning curve. This printing process has its own intricacies and there are different issues to debug than I was used to on FDM machines. It took 3 or 4 iterations before I established how to avoid vacuum pockets forming in the print, and how to arrange the support structure to avoid warping. Once I was happy with the part and its fabrication, I printed a top and bottom case in black “rigid polyurethane” on the Carbon 3D. All the Carbon3D resin chemistries are proprietary so beyond “polyurethane,” I really have no idea what the parts are made of. They were durable though and worked beautifully.</p>

<h3 id="tpe-gaskets">TPE Gaskets</h3>
<p>The weakness of our double case sandwich approach is the potential leak at the interface between the cases and the frame. We had seen rubber gaskets used in other systems at an interface which needed to be watertight. A flexible 3D printing filament called thermal polyurethane (TPE) came to mind. I designed some gaskets which fit along the footprint of the top and bottom case along the frame. They are meant to be compressed when the top and bottom plate sandwich the frame using a few M2 nuts and bolts. I printed the gaskets in orange <a href="https://www.amazon.com/NinjaFlex-TPU-3D-Printing-Filament/dp/B01LXZYJ3R/ref=sr_1_1?ie=UTF8&amp;qid=1514450027&amp;sr=8-1&amp;keywords=ninjaflex">NinjaFlex</a> TPE on my personal Printrbot Simple and over-extruded the prints severely to ensure better-than-average layer adhesion. The gaskets would be adhered to the cases with CA glue with the exposed interface between the case and gasket covered in watertight <a href="https://www.amazon.com/MG-Chemicals-Silicone-Modified-Conformal/dp/B008O9YIV6/ref=sr_1_1?s=industrial&amp;ie=UTF8&amp;qid=1514450052&amp;sr=1-1&amp;keywords=silicon+conformal+coating">silicon conformal coating.</a></p>

<h3 id="frame">Frame</h3>
<p>Ideally, the custom frame would be cut from a 3mm thick plate of carbon fiber. It would be rigid, light weight, and durable. We had the carbon purchased, but unfortunately, we were finishing this project towards the end of the semester. During the last week of class, the waterjet we needed to access to safely CNC cut the carbon was booked due to other class projects being due for many other students. Cutting the carbon on a typical CNC mill would be a hard sell to the machine shop technicians as carbon fiber dust is one of the last things you’d like in your lungs. 3D printing to the rescue again… we recruited our good friend Eric to complete a specialty print for us. Eric owns a printer with several upgrades allowing him to print abrasive and high-temperature filaments. He printed us a frame out of carbon-reinforced nylon, an extremely durable material. It’s not as clean as the carbon fiber plate we planned on, but it’s rigid enough to be flight worthy.</p>

<h2 id="assembly-and-delivery">Assembly and Delivery</h2>

<p>After removing excess pins, direct soldering all the components together, and installing a voltage divider for stepping down the input to the VBAT sensor, we covered all the electronics in 2 coats of silicon conformal coating for safety in the off chance that any moisture got inside the case.</p>

<p><span class="image main"><img src="/images/waterproof/waterproof3.png" alt=""></span></p>

<p>Modification to the PX4 firmware running on the Crazyflie is necessary for the PWM signal output to the ESC to be read correctly, and thus appropriately control the motors. PWM signal timing was adjusted to the standard 1000-2000 microsecond period, but the logic level of the signal worked out of the box. We also changed a hard-coded scaling factor to read the correct battery voltage from our new VBAT sensing resistor values.</p>

<h2 id="hop-test">Hop Test</h2>

<div class="video-wrapper">
	<div class="video-responsive">
		<iframe width="560" height="315" src="https://www.youtube.com/embed/y4-ZcgsTGAQ" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen=""></iframe>
	</div>
</div>

      		</section>

					<!-- Footer -->
						<footer>
              <ul class="actions">
                <li><a href="/projects/" class="button">Projects</a></li>
              </ul>
						</footer>
					</div>

				<!-- Footer -->
        <footer id="footer">
  <section>
    <!-- Formspree form for adding a email form to the status site -->
    <form method="POST" action="https://formspree.io/tfortmuller@berkeley.edu">
      <div class="field">
        <label for="name">Name</label>
        <input type="text" name="name" id="name">
      </div>
      <div class="field">
        <label for="email">Email</label>
        <input type="text" name="email" id="email">
      </div>
      <div class="field">
        <label for="message">Message</label>
        <textarea name="message" id="message" rows="3"></textarea>
      </div>
      <ul class="actions">
        <li><input type="submit" value="Send Message"></li>
      </ul>
    </form>
  </section>

  <!-- Contact side section -->
  <section class="split contact">

    <!-- Location -->
    <section class="alt">
      <h3>Location</h3>
      <p>Orange County, CA</p>
    </section>

    <!-- Connect -->
    <section>
      <h3>Connect</h3>
      <ul class="icons alt">
        <li><a href="https://www.linkedin.com/in/trey-fortmuller" class="icon fa-linkedin" rel="nofollow"><span class="label">LinkedIn</span></a></li>
        <li><a href="https://github.com/treyfortmuller" class="icon fa-github" rel="nofollow"><span class="label">GitHub</span></a></li>
        <!-- <li><a href="https://facebook.com/trey.fortmuller" class="icon fa-facebook" rel="nofollow"><span class="label">Facebook</span></a></li> -->
      </ul>
    </section>
    
  </section>
</footer>
<!-- Copyright bottom section -->
<div id="copyright">
  <ul>
      <li>© 
    2019 Trey Fortmuller </li>
      <li> Based on a Design by <a href="https://html5up.net">HTML5 UP</a>
</li>
    </ul>
</div>


			</div>

      <!-- Scripts -->
  		<!-- DYN -->
<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/jquery.scrollex.min.js"></script>
<script src="/assets/js/jquery.scrolly.min.js"></script>
<script src="/assets/js/skel.min.js"></script>
<script src="/assets/js/util.js"></script>
<script src="/assets/js/main.js"></script>

			<script async src="https://www.googletagmanager.com/gtag/js?id=UA-111812042-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments)};
  gtag('js', new Date());

  gtag('config', 'UA-111812042-1');
</script>


	</body>
</html>
